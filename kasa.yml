- name: Dodanie DNS
  lineinfile:
    path: "{{ montowanie }}/etc/resolv.conf"
    line: nameserver 8.8.8.8

- name: apt update
  command: chroot "{{ montowanie }}" apt update

- name: apt instalacja pakietÃ³w
  command: chroot "{{ montowanie }}" apt install --yes xkasnet-client-2.2.17=2.2.17r202210061421~jammy-1 xkasnet-libnative-jni-2.2.17=2.2.17r202210061421~jammy-1 x-pos-launcher kasnet-server-2.1.335 kasnet-src-2.1.335 kasnet-config-2.1.335 kasnet-libwaga-2.1.335 kasnet-tools-2.1.335

- name: run-config
  shell: "touch {{ montowanie }}/home/kasa/.run-config"

- name: run-config chown
  shell: "chown 1000:1000 {{ montowanie }}/home/kasa/.run-config"

- name: config
  shell: "echo 'kasa.config-1024x768' > {{ montowanie }}/home/kasa/CONFIG ; chown 1000:1000 {{ montowanie }}/home/kasa/CONFIG"

- name: zmiana configa openssl
  lineinfile:
    state: present
    dest: "{{ montowanie }}/etc/ssl/openssl.cnf"
    insertafter: '#.include filename'
    line: "{{ item }}"
  with_items:
    - 'openssl_conf = default_conf'

#- name: zmiana configa openssl2
#  lineinfile:
#    state: present
#    dest: "{{ montowanie }}/etc/ssl/openssl.cnf"
#    insertafter: 'CipherString = DEFAULT:@SECLEVEL=2'
#    line: "{{ item }}"
#  with_items:
#    - '[ default_conf ]'
#    - 'ssl_conf = ssl_sect'
#    - '[ssl_sect]'
#    - 'system_default = ssl_default_sect'
#    - '[ssl_default_sect]'
#    - 'MinProtocol = TLSv1.2'
#    - 'CipherString = DEFAULT:@SECLEVEL=0'


- name: zmiana configa openssl2
  blockinfile:
    path: "{{ montowanie }}/etc/ssl/openssl.cnf"
    insertafter: "CipherString = DEFAULT:@SECLEVEL=2"
    block: |
      [ default_conf ]
      ssl_conf = ssl_sect
      [ssl_sect]
      system_default = ssl_default_sect
      [ssl_default_sect]
      MinProtocol = TLSv1.2
      CipherString = DEFAULT:@SECLEVEL=0
